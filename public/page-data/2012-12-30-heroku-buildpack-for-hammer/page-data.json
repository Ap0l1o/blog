{"componentChunkName":"component---src-components-post-post-jsx","path":"/2012-12-30-heroku-buildpack-for-hammer/","result":{"data":{"markdownRemark":{"html":"<p>I have recently been developing a few static sites using <a href=\"http://hammerformac.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hammer</a>, a great little Mac app that handles compiling resources and putting together parts of web pages to create static websites. Hammer is also able to publish drafts to <a href=\"http://hammr.co/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hammr.co</a>, which is great for getting some feedback and showing different versions of a design, but not suited for hosting a site in production.</p>\n<p>Although it would be easy to put the static site on any one of the nearly infinte shared hosting or VPS services out there, I already have a few sites on Heroku, I find the deployment process easy, and I know that most of the time I can get away with staying on the free plan! For these reasons, I set out to make it easy to deploy a static site built with Hammer to Heroku.</p>\n<p>Heroku allows custom ‘buildpacks’ which are scripts that can package up an ‘app’ or site for release. These can do some <a href=\"https://github.com/mattt/heroku-buildpack-core-data\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">really cool things</a>, but I just wanted to serve static content with <a href=\"http://nginx.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nginx</a>. There are a few static buildpacks out there, but many use Apache whereas I wanted Nginx, and the Nginx buildpacks mostly require a fair amount of configuration so would need to be forked for use on Hammer sites anyway. I have been wanting to try creating a buildpack for a while, so I thought this was a good opportunity to try.</p>\n<h4 id=\"creating-the-buildpack\" style=\"position:relative;\"><a href=\"#creating-the-buildpack\" aria-label=\"creating the buildpack permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the Buildpack</h4>\n<p>Buildpacks are composed of three scripts:</p>\n<ul>\n<li><code>detect</code> — Test to see if an application can be deployed with this buildpack.</li>\n<li><code>compile</code> — Set up the application and anything else required to deploy it in the <code>BUILD_DIR</code>.</li>\n<li><code>release</code> — Provide a list of required addons and process types to Heroku.</li>\n</ul>\n<p>The <code>detect</code> script for my buildpack is trivial. As Hammer compiles a site to a <code>Build</code> directory it tests for the existence of this and fails if it is not found.</p>\n<script src=\"https://gist.github.com/4413862.js\"></script>\n<p>Once this has run and determined that the application can be built with this pack, we need to download and compile Nginx in the <code>compile</code> script.</p>\n<script src=\"https://gist.github.com/4413883.js\"></script>\n<p>At the end, this compile script creates <code>boot.sh</code>. We have a Nginx configuration file that we need to use when running the site, but at the time of building we do not yet know what port Heroku wants the application to run on. Because of this, at the moment the script is called <code>nginx.conf.erb</code> and contains a placeholder for the port. <code>boot.sh</code> will compile the template at runtime and then launch Nginx.</p>\n<script src=\"https://gist.github.com/4413900.js\"></script>\n<p>A few things to note in this Nginx config (that I learnt the hard way) are that as Heroku expects the <code>boot.sh</code> script to run for the lifetime of the process, we must tell Nginx not to run as a daemon, which its default behaviour. Also, by default, if Nginx is not running on port 80, it will redirect links to the port it is running on. As Heroku reverse proxies traffic to the applications we do not want this to happen as visitors will access the site on port 80. To stop this, the location must have <code>port_in_redirect off;</code> set.</p>\n<p>Finally, Heroku requires a <code>release</code> script which should return a YAML formatted configuration for the addons that are required, and for the processes that the application can run. In this case we have no addons, and only one type of process which runs <code>boot.sh</code>.</p>\n<script src=\"https://gist.github.com/4413947.js\"></script>\n<br/>\n<h4 id=\"using-the-hammer-buildpack\" style=\"position:relative;\"><a href=\"#using-the-hammer-buildpack\" aria-label=\"using the hammer buildpack permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using the Hammer Buildpack</h4>\n<p>Turning a site developed with Hammer into a Heroku application is easy. The directory needs to be managed with Git, but once the repository is all set up just create and deploy.</p>\n<script src=\"https://gist.github.com/4414082.js\"></script>\n<br/>\n<h4 id=\"future\" style=\"position:relative;\"><a href=\"#future\" aria-label=\"future permalink\" class=\"header-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Future</h4>\n<p>I am hoping to get this set up to handle errors with custom error pages, but for now it is good enough for my needs.</p>\n<p>This is the first Nginx configuration I have written, so if you think I have missed something important, please open an issue on <a href=\"https://github.com/danpalmer/heroku-buildpack-hammer/issues\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">danpalmer/heroku-buildpack-hammer</a> or submit a pull-request with your changes.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n  }\n  \n  .grvsc-code {\n    display: inline-block;\n    min-width: 100%;\n  }\n  \n  .grvsc-line {\n    display: inline-block;\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-line-highlighted {\n    background-color: var(--grvsc-line-highlighted-background-color, transparent);\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);\n  }\n  \n</style>","fields":{"slug":"/2012-12-30-heroku-buildpack-for-hammer/"},"frontmatter":{"title":"Heroku Buildpack for Hammer","theme":null,"originally_on_thread":null,"date":"30 December, 2012"}},"site":{"siteMetadata":{"title":"Dan Palmer","description":"Personal site and blog"}}},"pageContext":{"slug":"/2012-12-30-heroku-buildpack-for-hammer/"}}}